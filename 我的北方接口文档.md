# æˆ‘çš„åŒ—æ–¹æ¥å£æ–‡æ¡£
[TOC]
## æ¥å£æ ‡å‡†
å‚è€ƒ[RESTful API è®¾è®¡æŒ‡å—](http://www.ruanyifeng.com/blog/2014/05/restful_api.html)ã€‚
### è®¾è®¡ç†å¿µåŠåŸåˆ™
æ¥å£å°½å¯èƒ½æ»¡è¶³Restfulçš„è®¾è®¡ç†å¿µã€‚ æ¯ä¸€ä¸ªæ¥å£ä»£è¡¨ä¸€ç§èµ„æºï¼Œä»¥åè¯è¡¨ç¤ºã€‚å¯¹èµ„æºçš„æ“ä½œï¼ˆåŠ¨è¯ï¼Œå³å¢åˆ æ”¹æŸ¥/CURDï¼‰ç”±HTTP 1.1ä¸­çš„`GET`ï¼ˆæŸ¥è¯¢/retrieveï¼‰ã€`POST`ï¼ˆæ–°å»º/createï¼‰ã€`PUT`ï¼ˆæ›´æ–°/updateï¼‰å’Œ`DELETE`ï¼ˆåˆ é™¤/deleteï¼‰å››ç§æ–¹æ³•æ¥è¡¨ç¤ºã€‚ æ¥å£è·¯å¾„ä¸­å«æœ‰å¤šä¸ªå•è¯æ—¶è¯·ä½¿ç”¨è¿å­—ç¬¦`-`ã€‚è·å–èµ„æºæ—¶éœ€è¦è¿‡æ»¤åˆ™å‚è€ƒå¯¹åº”æ¥å£ä¸‹å¯ä¾›ç­›é€‰çš„å­—æ®µæ„å»ºè¯·æ±‚ã€‚
### è¯·æ±‚
#### èº«ä»½è®¤è¯
å¤§éƒ¨åˆ†æ¥å£éƒ½éœ€è¦*èº«ä»½è®¤è¯*ï¼Œåœ¨`Request Headers`ä¸­å¢åŠ `Token`å­—æ®µï¼Œæ¯ä¸ªç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…ä¸å”¯ä¸€ä¸€ä¸ª`Token`å¯¹åº”ã€‚

æµ‹è¯•æœæ°¸ä¹…`Token`ï¼š`001tiITq09tJFl10qATq0jb0Uq0tiITD`

è¿™ä¸ª`Token`ä¸å—**MongoDB**`TTL`ç´¢å¼•å½±å“ã€‚å…³äº`TTL`ç´¢å¼•è¯·[å‚è€ƒæ­¤å¤„](http://www.mongoing.com/docs/core/index-ttl.html)ã€‚

è¯·æ±‚éœ€è¦èº«ä»½è®¤è¯çš„æ¥å£æ—¶å¿…é¡»æºå¸¦æœ‰æ•ˆçš„`Token`å¦åˆ™æœåŠ¡å™¨å°†è¿”å›`401`ã€‚
`Token`è¿‡æœŸä¹‹ååº”é‡æ–°è¯·æ±‚ç™»é™†æ¥å£è·å–æ–°çš„`Token`ã€‚
**ä¸éœ€è¦è®¤è¯çš„æ¥å£å°†ä½¿ç”¨â€œğŸŒâ€æ ‡æ˜ï¼Œéœ€è¦è®¤è¯çš„æ¥å£ç”¨â€œğŸ”‘â€æ ‡æ˜ã€‚**

#### è¯·æ±‚å‚æ•°ä¼ é€’
* **GET**
é˜Ÿåˆ—å‚æ•°ï¼Œä¾‹ï¼š`/v1/test?id=001&name=tom`
* **POST**
form-data
* **PUT**
form-data
* **DELETE**
é˜Ÿåˆ—å‚æ•°

âš ï¸åæ–‡ä¸­çš„æ‰€æœ‰æ¥å£çš„å‚æ•°å°†é€šè¿‡è¡¨æ ¼çš„å½¢å¼å±•ç¤ºï¼Œå®é™…ä¼ å‚ä¸å†èµ˜è¿°ã€‚

#### æ¥å£è·¯ç”±

ä»¥2çº§æ ‡é¢˜æ³¨æ˜æ¥å£åç§°å’Œè·¯å¾„ï¼Œå½¢å¦‚ï¼š

<img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga59fj352xj30ms04q74s.jpg" alt="image-20191222095002473" style="zoom:33%;" />

å¯¹äºæºå¸¦å‚æ•°çš„å¯å˜è·¯ç”±ï¼Œå½¢å¦‚ï¼š

<img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga59k9n5whj30qe04474k.jpg" alt="image-20191222095437892" style="zoom:33%;" />

å…¶ä¸­å°–æ‹¬å·æ‹¬èµ·çš„å°±æ˜¯å¯å˜å‚æ•°ã€‚

æ¯ä¸ªæ¥å£æ¥å—è‹¥å¹²ç§è¯·æ±‚æ–¹æ³•ï¼Œæ¯ä¸ªè¯·æ±‚æ–¹æ³•ä»¥3çº§æ ‡é¢˜æ³¨æ˜ï¼Œå½¢å¦‚ï¼š

<img src="https://tva1.sinaimg.cn/large/006tNbRwly1ga59ouufr2j30d603474f.jpg" alt="image-20191222095902438" style="zoom:33%;" />

### å“åº”
âš ï¸HTTPå“åº”çŠ¶æ€ç é™¤æœåŠ¡å™¨é”™è¯¯ä¸º`500`ä¹‹å¤–ç»Ÿä¸€ä¸º`200`ï¼Œæ­£å¼ç‰ˆæœ¬ç†è®ºä¸Šä¸åº”è¯¥å‡ºç°`500`é”™è¯¯ã€‚
é™¤ç‰¹æ®Šèµ„æºå¤–ç»Ÿä¸€ä½¿ç”¨`json`æ•°æ®æ ¼å¼ï¼Œä¸€ä¸ªæ ‡å‡†çš„å“åº”æ•°æ®å¦‚ä¸‹ï¼š

```json
{
    "code":401,
    "m":"èº«ä»½è®¤è¯å¤±è´¥",
    "data":{}
}
```
å…¶ä¸­`code`ä¸ºå“åº”çš„çŠ¶æ€ç ï¼Œä»¥ä¸‹æ˜¯æ‰€æœ‰æ¥å£é€šç”¨çš„çŠ¶æ€ç åŠå…¶å«ä¹‰ï¼š

* `200` OK
  	è¯·æ±‚æˆåŠŸã€‚
  
* `401`  Unauthorized
  	éœ€è¦èº«ä»½è®¤è¯ã€‚è¯·æ±‚éœ€è¦è®¤è¯çš„æ¥å£ä½†æ²¡æœ‰æºå¸¦`Token`æˆ–`Token`å·²ç»è¿‡æœŸçš„æƒ…å†µä¸‹ä¼šè¿”å›`401`ï¼Œå®¢æˆ·ç«¯åº”è¯¥å¯¹è¿™ç§çŠ¶æ€ç è¿›è¡Œç»Ÿä¸€å°è£…å¤„ç†ã€‚
  
* `404` Not Found
æ²¡æœ‰è¯·æ±‚çš„èµ„æºã€‚
  

è¯·æ±‚æ­£å¸¸å®Œæˆå‡ä¼šè¿”å›`200`ï¼Œæ­¤æ—¶å¯ä»¥è®¿é—®`data`å­—æ®µè·å–éœ€è¦çš„æ•°æ®ï¼Œ`data`å¯èƒ½æ˜¯å¯¹è±¡æˆ–åˆ—è¡¨ã€‚

 `code`é`200`æ˜¯å¼‚å¸¸æƒ…å†µï¼Œåœ¨`m`å­—æ®µä¸­ä¼šè¿”å›é”™è¯¯çš„åŸå› ï¼Œå®¢æˆ·ç«¯æ ¹æ®éœ€è¦å¯ä»¥ç›´æ¥æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚

æ¯ä¸ªæ¥å£å¯èƒ½æœ‰è‡ªå·±å®šä¹‰çš„é”™è¯¯ä»£ç ã€‚

## æ•°æ®å®šä¹‰
### UserInfo

ç”¨æˆ·ä¿¡æ¯

```json
{
    "sno": "17152010921",
    "sex": "ç”·",
  	"nickName":"BBfat",
    "avatarUrl": "...",
    "name": "é æ¬£è¯š",
    "openid": "o1Glo5BZgdDoVqkuXgKzSw_r4T_M",
    "class": "ç»ç®¡17",
    "college": "ç»æµç®¡ç†å­¦é™¢",
    "source": "å±±è¥¿çœ"
}
```

### Course

è¯¾ç¨‹ä¿¡æ¯

```json
{
    "course_name": "æ•°æ®åº“åŸç†",
    "course_code": "2019_A_7234801_2019A510025",
    "teacher_name": "",
    "role": "student",
    "course_class": "è®¡17-123;è®¡ä¸“èµ·æœ¬19"
}
```

### Courseware

è¯¾ä»¶ä¿¡æ¯

```json
{
    "url": "http://iclass.ncut.edu.cn/iclass/netclass/backends/download_api.php?url=L8r9vt2%2F4tStwO0tLcq10enWuLW8yumjqDIwMTnE6sfvvL6jqS5uZXSw5rG%2BLmRvYw%3D%3D&cidReset=true&cidReq=2019_A_7234801_2019A510025",
    "type": "file",
    "size": 1751040,
    "date": "2019-11-29",
    "course_code": "2019_A_7234801_2019A510025",
    "filename": "æ•°æ®åº“åŸç†--å®éªŒæŒ‡å¯¼ä¹¦ï¼ˆ2019å¹´ç§‹å­£ï¼‰.netç‰ˆæœ¬.doc",
  	"_id": "5e02cea797c32ce21d820563"
}
```

`Courseware`ä¸å•ç‹¬å¼€é›†åˆå­˜å‚¨ï¼Œä»…ä»¥å†…åµŒæ–‡æ¡£çš„æ–¹å¼å­˜æ”¾åœ¨éœ€è¦çš„åœ°æ–¹ã€‚

## ğŸŒèº«ä»½è®¤è¯ï¼š`/v1/auth`

### `POST`ç­¾å‘Token

| å‚æ•°åç§° | å‚æ•°ç±»å‹ | å¤‡æ³¨             |
| -------- | -------- | ---------------- |
| code     | String   | å¾®ä¿¡ä¸´æ—¶ç™»é™†å‡­è¯ |

`code`æ˜¯é€šè¿‡å°ç¨‹åºçš„`wx.login()`å‡½æ•°ç”Ÿæˆçš„ä¸´æ—¶ç™»é™†ç ï¼Œå‚è€ƒï¼š[wx.login()æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html) [å°ç¨‹åºç™»é™†](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)
å°ç¨‹åºæœåŠ¡å™¨ä¼šå’Œå¾®ä¿¡æœåŠ¡å™¨é€šä¿¡å¹¶è·å–è¯¥ç”¨æˆ·çš„`openid`ã€‚

#### æˆæƒç”¨æˆ·ç­¾å‘

```json
{
    "code":200,
    "m":"",
    "data":{
        "Token":"qwerty"
    }
}
```

#### éæˆæƒç”¨æˆ·æ‹’ç»ç­¾å‘

```json
{
    "code":401,
    "m":"Unauthorized",
    "data":null
}
```

æ­¤æ—¶å®¢æˆ·ç«¯åº”è¯¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œæ‹‰èµ·ä¼ä¸šå·OAuthç™»é™†é¡µé¢ï¼Œå°è¯•æˆæƒï¼ŒæˆæƒæˆåŠŸä¹‹åå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚ç­¾å‘`Token`å°±ä¼šæˆåŠŸã€‚

åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦æ˜¯æˆæƒç”¨æˆ·çš„æ¡ä»¶æ˜¯ï¼š**æ•°æ®åº“ä¸­æœ‰æ²¡æœ‰è¯¥openidå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ã€‚**

å…³äºæ³¨å†Œç›¸å…³çš„å†…å®¹ç”±äºå’Œæ¥å£æ— å…³ï¼Œå°†åœ¨å¦ä¸€ç¯‡æ–‡æ¡£ä¸­è¯¦ç»†è®¨è®ºã€‚

## ğŸŒBannerï¼š`/v1/banner`

### `GET`è·å–ä¿¡æ¯

è¿”å›é¦–é¡µçš„Bannerå’ŒNoticeçš„æ•°æ®ï¼Œ*è¿™ä¸ªæ¥å£è®¾è®¡æœ‰å¯èƒ½æ›´æ”¹*ã€‚

```json
{
    "code": 200,
    "m": "",
    "data": {
        "indexBanner": [
            {
                "index": 0,
                "msgurl": "https://mp.weixin.qq.com/s/ajKyJpTMa-mi5WiNbZ2s3A",
                "imgurl": "https://myncut.oss-cn-beijing.aliyuncs.com/Banner/å°é¢.jpg?x-oss-process=image/auto-orient,1/quality,q_70"
            },
            {
                "index": 1,
                "msgurl": "https://mp.weixin.qq.com/s/2QGJhSZacjwseBME-xXbKw",
                "imgurl": "https://myncut.oss-cn-beijing.aliyuncs.com/Banner/1618e1b390bff8efc395356559ca5ed.jpg?x-oss-process=image/auto-orient,1/quality,q_70"
            },
            {
                "index": 2,
                "imgurl": "https://myncut.oss-cn-beijing.aliyuncs.com/Banner/7aaf933cbfaa8ef99a5376b4f20f218.png?x-oss-process=image/auto-orient,1/quality,q_70",
                "msgurl": "https://mp.weixin.qq.com/s/blM2FdhFpXy_rcJWr5bB5g"
            },
            {
                "index": 3,
                "imgurl": "https://myncut.oss-cn-beijing.aliyuncs.com/Banner/WechatIMG470.jpeg?x-oss-process=image/auto-orient,1/quality,q_70",
                "msgurl": "https://mp.weixin.qq.com/s/M7yratKQdZ9yxMDf-yrz3w"
            },
            {
                "index": 4,
                "imgurl": "https://myncut.oss-cn-beijing.aliyuncs.com/Banner/566710ea35fc65929e63927268d2924.png?x-oss-process=image/auto-orient,1/quality,q_70",
                "msgurl": "https://mp.weixin.qq.com/s/8Hro-TB9CwCGtQZUWAxI-Q"
            }
        ],
        "indexNotice": [
            {
                "index": 0,
                "text": "å¤©çœŸçš„å¤ªå†·äº†ï¼è£¹ç€è¢«å­å‡ºé—¨å§ï¼"
            },
            {
                "index": 1,
                "text": "ä¸‹æ‹‰åˆ·æ–°å¤šæ¨¡å¼è¯¾ç¨‹"
            },
            {
                "index": 2,
                "text": "2.1.0ç‰ˆæœ¬ä¸Šçº¿ï¼banneræ¨å¹¿æ‰¾æˆ‘ä»¬ï¼"
            }
        ]
    }
}
```

## ğŸ”‘ç”¨æˆ·ä¿¡æ¯ï¼š`/v1/user`

### `GET`è·å–ç”¨æˆ·ä¿¡æ¯

è¿”å›å®Œæ•´çš„ç”¨æˆ·æ•°æ®ï¼Œè¿™ä¸ªæ¥å£åªèƒ½è¯·æ±‚å¹¶å¾—åˆ°è¯·æ±‚è€…çš„ç”¨æˆ·ä¿¡æ¯ã€‚

```json
{
    "code": 200,
    "m": "",
    "data": {
        "sno": "17152010921",
        "sex": "ç”·",
        "nickName": "BBfat",
        "avatarUrl": "https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppGVBbicu6niaOOr2IrkqN9kiaQibqd74xWf1IeuSWoqb9Np5wstDXggMkZsFibwSB4ia7ehCIEiaDbxRtA/132",
        "name": "é æ¬£è¯š",
        "openid": "o1Glo5BZgdDoVqkuXgKzSw_r4T_M",
        "class": "ç»ç®¡17",
        "college": "ç»æµç®¡ç†å­¦é™¢",
        "source": "å±±è¥¿çœ"
    }
}
```

## ğŸ”‘æ”¶è—å†…å®¹ï¼š`/v1/favorites/<type>`

å…¶ä¸­`type`æ˜¯æ”¶è—çš„å†…å®¹ï¼Œç›®å‰æ”¯æŒï¼š`courseware`è¯¾ä»¶ã€`goods`å•†å“ã€‚

### `GET`è·å–æ”¶è—å¤¹å†…å®¹

è¿”å›è¯¥ç”¨æˆ·å¯¹åº”ç±»å‹çš„æ”¶è—å¤¹åˆ—è¡¨ã€‚

* `courseware`

  ```
  
  ```

* `goods`

  ```
  
  ```

### `PUT`å¢åŠ æ”¶è—å†…å®¹

### `DELETE`åˆ é™¤æ”¶è—å†…å®¹

## ğŸ”‘æ ¡ç½‘æ•°æ®ï¼š`/v1/net`

### `GET`è·å–æ ¡ç½‘æ•°æ®

è¿”å›å®Œæ•´çš„æ ¡ç½‘æ•°æ®ï¼Œè¿™ä¸ªæ¥å£åªèƒ½è¯·æ±‚å¹¶å¾—åˆ°è¯·æ±‚è€…çš„ç”¨æˆ·ä¿¡æ¯ã€‚

```

```

## ğŸ”‘å¤šæ¨¡å¼è¯¾ç¨‹ï¼š`/v1/iclass/course`

### `GET`è·å–è¯¾ç¨‹åˆ—è¡¨

```json
{
    "code": 200,
    "m": "",
    "data": [
        {
            "course_name": "æ•°æ®åº“åŸç†",
            "course_code": "2019_A_7234801_2019A510025",
            "teacher_name": "",
            "role": "student",
            "course_class": "è®¡17-123;è®¡ä¸“èµ·æœ¬19"
        },
        {
            "course_name": "æ“ä½œç³»ç»Ÿ",
            "course_code": "2019_A_7205001_2019A510013",
            "teacher_name": "",
            "role": "student",
            "course_class": "è®¡å®éªŒ17;è®¡17-123 ;è®¡ä¸“èµ·æœ¬19"
        },
        {
            "course_name": "Javaç¨‹åºè®¾è®¡",
            "course_code": "2019_S_7002501_2019S510015",
            "teacher_name": "éƒ­å³°(è®¡)",
            "role": "student",
            "course_class": "è®¡17-123;è®¡å®éªŒ17;å¤§æ•°æ®18"
        }
    ]
}
```

## ğŸ”‘å¤šæ¨¡å¼è¯¾ç¨‹èµ„æ–™ï¼š`/v1/iclass/courseware`

### `GET`è·å–èµ„æ–™åˆ—è¡¨

| å‚æ•°åç§°    | ç±»å‹   | å¤‡æ³¨     |
| ----------- | ------ | -------- |
| course_code | String | è¯¾ç¨‹ä»£ç  |

```json
{
    "code": 200,
    "m": "",
    "data": [
        {
            "url": "http://iclass.ncut.edu.cn/iclass/netclass/backends/download_api.php?url=L8r9vt2%2F4tStwO0tLcq10enWuLW8yumjqDIwMTnE6sfvvL6jqS5uZXSw5rG%2BLmRvYw%3D%3D&cidReset=true&cidReq=2019_A_7234801_2019A510025",
            "type": "file",
            "size": 1751040,
            "date": "2019-11-29",
            "course_code": "2019_A_7234801_2019A510025",
            "filename": "æ•°æ®åº“åŸç†--å®éªŒæŒ‡å¯¼ä¹¦ï¼ˆ2019å¹´ç§‹å­£ï¼‰.netç‰ˆæœ¬.doc",
            "_id": "5e02cea797c32ce21d820563"
        },
        {
            "url": "http://iclass.ncut.edu.cn/iclass/netclass/backends/download_api.php?url=L7XaONXCOC43X8r9vt2%2F4sGsvdO8vMr1LnBwdA%3D%3D&cidReset=true&cidReq=2019_A_7234801_2019A510025",
            "type": "file",
            "size": 1899520,
            "date": "2019-11-29",
            "course_code": "2019_A_7234801_2019A510025",
            "filename": "ç¬¬8ç« 8.7_æ•°æ®åº“è¿æ¥æŠ€æœ¯.ppt",
            "_id": "5e02cea797c32ce21d820555"
        },
        {
            "url": "http://iclass.ncut.edu.cn/iclass/netclass/backends/download_api.php?url=L7XaMdXC0PfC2y5wcHQ%3D&cidReset=true&cidReq=2019_A_7234801_2019A510025",
            "type": "file",
            "size": 4470784,
            "date": "2019-09-10",
            "course_code": "2019_A_7234801_2019A510025",
            "filename": "ç¬¬1ç« ç»ªè®º.ppt",
            "_id": "5e02cea797c32ce21d820558"
        }
    ]
}
```

## ğŸ”‘ä¸‹è½½å¤šæ¨¡å¼è¯¾ä»¶ï¼š`/v1/iclass/courseware/download`

### `GET`ç›´æ¥ä¸‹è½½

| å‚æ•°åç§°    | ç±»å‹   | å¤‡æ³¨     |
| ----------- | ------ | -------- |
| course_code | String | è¯¾ç¨‹ä»£ç  |
| filename    | String | æ–‡ä»¶å   |

è¿”å›æ–‡ä»¶å†…å®¹ï¼Œç»æµ‹è¯•Chromeå¯ä»¥ç›´æ¥é€šè¿‡è¿™ç§æ–¹å¼ä¸‹è½½ã€‚

å…¶ä¸­`ResponseHeaders`è®¾ç½®ç±»ä¼¼å¦‚ä¸‹å­—æ®µï¼š

`Content-Disposition: attachment;filename=æ•°æ®åº“åŸç†--å®éªŒæŒ‡å¯¼ä¹¦ï¼ˆ2019å¹´ç§‹å­£ï¼‰.netç‰ˆæœ¬.doc`

### `POST`ç”Ÿæˆå…¬å¼€ä¸‹è½½é“¾æ¥

| å‚æ•°åç§°    | ç±»å‹   | å¤‡æ³¨     |
| ----------- | ------ | -------- |
| course_code | String | è¯¾ç¨‹ä»£ç  |
| filename    | String | æ–‡ä»¶å   |

* æ­£å¸¸è¿”å›æ–‡ä»¶id

  ```json
  {
      "code": 200,
      "m": "",
      "data": {
          "id": "5e01a98497c32c30bdf6bb25"
      }
  }
  ```

* æ‰¾ä¸åˆ°æ–‡ä»¶

  ```json
  {
      "code": 404,
      "m": "æ— æ³•æ‰¾åˆ°æ–‡ä»¶",
      "data": null
  }
  ```

## ğŸŒé€šè¿‡ä¸´æ—¶é“¾æ¥ä¸‹è½½è¯¾ä»¶ï¼š`/v1/iclass/download`

### `GET`ä¸‹è½½

| å‚æ•°åç§° | ç±»å‹   | å¤‡æ³¨ |
| -------- | ------ | ---- |
| id       | String |      |

è¿”å›æ–‡ä»¶ã€‚